# The full project I did
Here you can find the code of my full project if you want with each flow.

## Code 
    [{"id":"d8f99284.f2a5a","type":"tab","label":"Capteurs_Sophia","disabled":false,"info":""},{"id":"55276915.b6b808","type":"tab","label":"Chart","disabled":false,"info":""},{"id":"e7ba57b9.797718","type":"tab","label":"Coordonnées satellites 2","disabled":true,"info":""},{"id":"728ebd67.6f43d4","type":"tab","label":"Flow 1","disabled":true,"info":""},{"id":"f152842b.3e7d48","type":"tab","label":"Coordonnées satellites 2","disabled":false,"info":""},{"id":"34aafdca.9c2a62","type":"subflow","name":"DB Test","info":"","category":"","in":[],"out":[],"env":[],"color":"#DDAA99"},{"id":"46051912.a9cae8","type":"subflow","name":"TLE","info":"","category":"","in":[{"x":320,"y":180,"wires":[{"id":"17c61a3.a0b33e6"}]}],"out":[{"x":860,"y":540,"wires":[{"id":"e1e7e471.1cb458","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"59de1744.528cf8","type":"subflow","name":"Distance","info":"","category":"","in":[{"x":460,"y":260,"wires":[{"id":"4d0fd5bf.f1538c"}]}],"out":[{"x":800,"y":380,"wires":[{"id":"69195511.7d424c","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"bece6195.3824f","type":"subflow","name":"Distance (2)","info":"","category":"","in":[{"x":460,"y":260,"wires":[{"id":"797d764c.de0698"}]}],"out":[{"x":800,"y":380,"wires":[{"id":"c6e24c02.52f6b","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"93e81b0f.94eea8","type":"mqtt-broker","z":"","name":"mqtt from TTn","broker":"eu.thethings.network","port":"5","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"ac69b075.a9d24","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"Sensor_IOT","name":"Sensor_iOT","usetls":false,"tls":""},{"id":"4b060ad2.62fbf4","type":"ttn app","z":"","appId":"ers4_poste8","accessKey":"ttn-account-v2.Uxnix2aYLL3gskyjJgpp1raDfKG7yIn8o_kgclNRyQw","discovery":"discovery.thethingsnetwork.org:1900"},{"id":"dc22eaee.c84498","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"GPS","name":"influxdb-GPS","usetls":false,"tls":""},{"id":"e933cc2b.454de","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"ERS42","name":"","usetls":false,"tls":""},{"id":"60748344.90604c","type":"ttn app","z":"","appId":"valrose","accessKey":"ttn-account-v2.gg2ImosZ1sYrrHkwZwyy9FtuSeFD_WSMT0-P3WvBORA","discovery":"discovery.thethingsnetwork.org:1900"},{"id":"12e19ba6.6eb284","type":"websocket-listener","z":"","path":"https://celestrak.com/satcat/tle.php?CATNR=44109","wholemsg":"false"},{"id":"291f3c2b.7c6904","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"ERS4","name":"","usetls":false,"tls":""},{"id":"749238df.b61e68","type":"websocket-client","z":"","path":"https://www.space-track.org/basicspacedata/query/class/omm/NORAD_CAT_ID/44109/orderby/EPOCH%20desc/limit/1/format/xml/emptyresult/show","tls":"","wholemsg":"false"},{"id":"f9fcd79e.6f7c98","type":"ttn app","z":"","appId":"ph0wn","accessKey":"ttn-account-v2.yTbE4m7S7rR7vDrRK7fEBtaL4GTN5ucffn02NT2VgC8","discovery":"discovery.thethingsnetwork.org:1900"},{"id":"16de6b60.76a4a5","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"lacuna","name":"","usetls":false,"tls":""},{"id":"89eee6e3.2d9ff8","type":"ttn app","z":"","appId":"ph0wn","accessKey":"ttn-account-v2.yTbE4m7S7rR7vDrRK7fEBtaL4GTN5ucffn02NT2VgC8","discovery":"discovery.thethingsnetwork.org:1900"},{"id":"e1b9cc71.55c3b","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"lacuna","name":"","usetls":false,"tls":""},{"id":"174efa6f.eb1176","type":"ui_tab","z":"","name":"Chart_v","icon":"dashboard","disabled":false,"hidden":false},{"id":"71d71016.b48c","type":"ui_group","z":"","name":"Input","tab":"174efa6f.eb1176","order":1,"disp":true,"width":"6","collapse":false},{"id":"c8a73cae.651d6","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"368d0d28.0089b2","type":"ui_tab","z":"","name":"Chart_v","icon":"dashboard","disabled":false,"hidden":false},{"id":"cf928aa.09eed78","type":"ui_group","z":"","name":"Print","tab":"174efa6f.eb1176","order":2,"disp":true,"width":"25","collapse":false},{"id":"5f205241.6e879c","type":"ui_group","z":"","name":"Charts","tab":"214b671.01fdb98","order":2,"disp":false,"width":"6"},{"id":"624ad29c.b92bcc","type":"ui_group","z":"","name":"Inputs","tab":"214b671.01fdb98","order":1,"disp":false,"width":"6"},{"id":"585c70cb.1581","type":"ui_group","z":"","name":"Group 3","tab":"214b671.01fdb98","order":3,"disp":false,"width":"6"},{"id":"214b671.01fdb98","type":"ui_tab","z":"","name":"Charts","icon":"dashboard","order":2},{"id":"bf9ea6cf.7977f8","type":"ui_group","z":"","name":"Charts","tab":"3f2c9f21.7f0c5","order":2,"disp":false,"width":"6"},{"id":"d80acedb.d3c8","type":"ui_group","z":"","name":"Inputs","tab":"3f2c9f21.7f0c5","order":1,"disp":false,"width":"6"},{"id":"77791a22.630a74","type":"ui_group","z":"","name":"Group 3","tab":"3f2c9f21.7f0c5","order":3,"disp":false,"width":"6"},{"id":"3f2c9f21.7f0c5","type":"ui_tab","z":"","name":"Charts","icon":"dashboard","order":2},{"id":"401de641.5da8e8","type":"ui_group","z":"","name":"Charts","tab":"4b1baadb.d5e174","order":2,"disp":false,"width":"6"},{"id":"ceb6bbfd.4d9318","type":"ui_group","z":"","name":"Inputs","tab":"4b1baadb.d5e174","order":1,"disp":false,"width":"6"},{"id":"e83d7ccd.448ea","type":"ui_group","z":"","name":"Group 3","tab":"4b1baadb.d5e174","order":3,"disp":false,"width":"6"},{"id":"4b1baadb.d5e174","type":"ui_tab","z":"","name":"Charts","icon":"dashboard","order":2},{"id":"461e59c1.0dda98","type":"ui_group","z":"","name":"Charts","tab":"7677e112.23f1a","order":2,"disp":false,"width":"6"},{"id":"215691cc.dc384e","type":"ui_group","z":"","name":"Inputs","tab":"7677e112.23f1a","order":1,"disp":false,"width":"6","collapse":false},{"id":"dfec3b71.699568","type":"ui_group","z":"","name":"Group 3","tab":"7677e112.23f1a","order":3,"disp":false,"width":"6"},{"id":"7677e112.23f1a","type":"ui_tab","z":"","name":"Charts","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"6ba4a95b.607038","type":"ui_group","z":"","name":"Charts","tab":"f37e61ba.5797e","order":2,"disp":false,"width":"6","collapse":false},{"id":"71bd0f2e.f499e","type":"ui_group","z":"","name":"Inputs","tab":"f37e61ba.5797e","order":1,"disp":false,"width":"6"},{"id":"5fe6f28c.9eccdc","type":"ui_group","z":"","name":"Group 3","tab":"f37e61ba.5797e","order":3,"disp":false,"width":"6"},{"id":"f37e61ba.5797e","type":"ui_tab","z":"","name":"Charts","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"57271881.94af08","type":"ui_group","z":"","name":"Charts","tab":"69b67819.11e928","order":2,"disp":false,"width":"6"},{"id":"5ff60162.f3356","type":"ui_group","z":"","name":"Inputs","tab":"69b67819.11e928","order":1,"disp":false,"width":"6"},{"id":"3a7d8466.1eb66c","type":"ui_group","z":"","name":"Group 3","tab":"69b67819.11e928","order":3,"disp":false,"width":"6"},{"id":"69b67819.11e928","type":"ui_tab","z":"","name":"Charts","icon":"dashboard","order":2},{"id":"14f84be7.84ca84","type":"gitlab-config","z":"","url":"http://222.255.135.133/gitlab","project_id":"12","name":"Lacuna"},{"id":"727410bf.71376","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"Sensor_IOT","name":"Sensor_iOT","usetls":false,"tls":""},{"id":"614e7de9.9f91a4","type":"ttn app","z":"","appId":"ph0wn","accessKey":"ttn-account-v2.yTbE4m7S7rR7vDrRK7fEBtaL4GTN5ucffn02NT2VgC8","discovery":"discovery.thethingsnetwork.org:1900"},{"id":"bc580014.0e55","type":"ttn app","z":"","appId":"ph0wn","accessKey":"ttn-account-v2.yTbE4m7S7rR7vDrRK7fEBtaL4GTN5ucffn02NT2VgC8","discovery":"discovery.thethingsnetwork.org:1900"},{"id":"185529ad.ef9206","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"lacuna","name":"","usetls":false,"tls":""},{"id":"4d05bc48.c82d84","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"Sensor_IOT","name":"Sensor_iOT","usetls":false,"tls":""},{"id":"8c9b96a.34f4a68","type":"ttn app","z":"","appId":"ph0wn","accessKey":"ttn-account-v2.yTbE4m7S7rR7vDrRK7fEBtaL4GTN5ucffn02NT2VgC8","discovery":"discovery.thethingsnetwork.org:1900"},{"id":"d8e4a73a.781d48","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"Sensor_IOT","name":"Sensor_iOT","usetls":false,"tls":""},{"id":"1bb3c7b2.7f62b8","type":"ttn uplink","z":"d8f99284.f2a5a","name":"Capteur interieur","app":"60748344.90604c","dev_id":"capteur_interieur","field":"","x":460,"y":120,"wires":[["8059b92d.6fd718"]]},{"id":"580769a.21c9098","type":"ttn uplink","z":"d8f99284.f2a5a","name":"Capteur Serre","app":"60748344.90604c","dev_id":"capteur_serre","field":"","x":730,"y":120,"wires":[["d861ff25.d3c16"]]},{"id":"8059b92d.6fd718","type":"function","z":"d8f99284.f2a5a","name":"","func":"msg.payload ={\n        T_int : msg.payload.temperature_1,\n        H_int: msg.payload.relative_humidity_2,\n        Lum_int : msg.payload.luminosity_4\n}\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":180,"wires":[["3a043dcb.326432"]]},{"id":"d861ff25.d3c16","type":"function","z":"d8f99284.f2a5a","name":"","func":"msg.payload ={\n        T_serre : msg.payload.temperature_1,\n        H_serre: msg.payload.relative_humidity_5,\n        Lum_serre : msg.payload.luminosity_4\n}\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":180,"wires":[["800248da.b8fe98"]]},{"id":"716f3fad.220bb","type":"ttn uplink","z":"d8f99284.f2a5a","name":"Device toto","app":"60748344.90604c","dev_id":"device_toto","field":"","x":140,"y":300,"wires":[["90fcd68a.331b88"]]},{"id":"c7f06bab.16af48","type":"ttn uplink","z":"d8f99284.f2a5a","name":"sensor smartcampus","app":"60748344.90604c","dev_id":"sensor_smartcampus","field":"","x":490,"y":320,"wires":[["21cb57d1.6655f8"]]},{"id":"90fcd68a.331b88","type":"function","z":"d8f99284.f2a5a","name":"","func":"msg.payload ={\n        T_toto : msg.payload.temperature_1,\n        H_toto: msg.payload.relative_humidity_2,\n        Lum_toto : msg.payload.luminosity_4\n}\nreturn msg;","outputs":1,"noerr":0,"x":130,"y":360,"wires":[["62e8d9b2.7afa28"]]},{"id":"21cb57d1.6655f8","type":"function","z":"d8f99284.f2a5a","name":"","func":"msg.payload ={\n        T_smartcampus : msg.payload.temperature_4,\n        H_smartcampus: msg.payload.relative_humidity_5,\n        Lum_smartcampus : msg.payload.luminosity_6\n}\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":360,"wires":[["477d4b4b.e7d944"]]},{"id":"3a043dcb.326432","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"Sensors_int","precision":"","retentionPolicy":"","x":490,"y":240,"wires":[]},{"id":"800248da.b8fe98","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"Sensors_Serre","precision":"","retentionPolicy":"","x":780,"y":240,"wires":[]},{"id":"62e8d9b2.7afa28","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"Sensors_toto","precision":"","retentionPolicy":"","x":190,"y":420,"wires":[]},{"id":"477d4b4b.e7d944","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"Sensors_smartcampus","precision":"","retentionPolicy":"","x":540,"y":420,"wires":[]},{"id":"ecf32158.c9492","type":"ttn uplink","z":"d8f99284.f2a5a","name":"test2","app":"f9fcd79e.6f7c98","dev_id":"test2","field":"","x":150,"y":560,"wires":[["b7c7c33d.2afb9","97dee037.b36aa"]]},{"id":"11b4f985.b1a4f6","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"Test2","precision":"","retentionPolicy":"","x":570,"y":540,"wires":[]},{"id":"b7c7c33d.2afb9","type":"function","z":"d8f99284.f2a5a","name":"","func":"var gatewaysarray = msg.metadata.gateways;\nvar rssi = [];\nvar logMsgs = [];\nvar moy;\n\nfor (i = 0; i < gatewaysarray.length; i++){\n    rssi[i]= gatewaysarray[i].rssi;}\n    moy = (rssi[0]+rssi[1])/2;\n\nmsg.payload ={\n       Accx : msg.payload.accx,\n       Accy : msg.payload.accy,\n       Accz : msg.payload.accz,\n       Humidity : msg.payload.humidity,\n       Lacuna_Sat : msg.payload.lacuna_sat,\n       Lat : msg.payload.lat,\n       Lon : msg.payload.lng,\n       Length : msg.payload.length,\n       Pressure : msg.payload.pressure,\n       Temp : msg.payload.temperature,\n       Tleage : msg.payload.tleage,\n       TTF : msg.payload.ttf,\n       Voltage : msg.payload.voltage,\n       Voltage_adc : msg.payload.voltage_adc,\n       Lacuna_sat : msg.payload.lacuna_sat,\n       RSSI : moy\n}\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":540,"wires":[["11b4f985.b1a4f6"]]},{"id":"97dee037.b36aa","type":"function","z":"d8f99284.f2a5a","name":"","func":"msg.payload ={\n        Accx : msg.payload.accx,\n        Accy : msg.payload.accy,\n        Accz : msg.payload.accz,\n    \n}\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":600,"wires":[["bd9ec67a.2e2208"]]},{"id":"bd9ec67a.2e2208","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"dist","precision":"","retentionPolicy":"","x":560,"y":600,"wires":[]},{"id":"5eb3afbf.4b13c","type":"function","z":"d8f99284.f2a5a","name":"","func":"msg.payload ={\n        T_ext : msg.payload.temperature_1,\n        H_ext: msg.payload.relative_humidity_2,\n        Lum_ext : msg.payload.luminosity_4,\n}\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":180,"wires":[["f2fa42cc.d6147"]]},{"id":"ca2d2051.e01b8","type":"ttn uplink","z":"d8f99284.f2a5a","name":"Capteur exterieur","app":"60748344.90604c","dev_id":"capteur_exterieur","field":"","x":180,"y":120,"wires":[["5eb3afbf.4b13c"]]},{"id":"f2fa42cc.d6147","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"Sensors_ext","precision":"","retentionPolicy":"","x":190,"y":240,"wires":[]},{"id":"d4f89fbf.c4394","type":"function","z":"55276915.b6b808","name":"","func":"var m = {};\nvar labels = []\nvar data = []\nvar time = [];\nvar time2 = [];\nvar hour=[],minutes=[],second=[];\nvar analog = [] ,luminosity = [],humidity=[],temperature=[];\n\nfor(i=0;i<msg.payload.length;i++){\nvar d = new Date(msg.payload[i].time);\nluminosity[i] = parseInt(msg.payload[i].Lum_ext);\nhumidity[i] = parseInt(msg.payload[i].H_ext);\ntemperature[i] = parseInt(msg.payload[i].T_ext);\n\ntime[i] = msg.payload[i].time;\nhour[i] = d.getHours(msg.payload[i].time);\nminutes[i] = d.getMinutes(msg.payload[i].time);\nsecond[i] = d.getSeconds(msg.payload[i].time);\ntime2[i] = hour[i] +\"h\"+ minutes[i] +\"min\" + second[i] + \"s\";\n}\n    m.series = [\"Luminosity\",\"Humidity\",\"Temperature\"];\n    m.data = [luminosity,humidity,temperature];\n    m.labels = time2;\nreturn {\n    payload:[m] ,\n    topic : msg.topic\n   \n    \n};","outputs":1,"noerr":0,"x":830,"y":60,"wires":[["cc868858.646ef8"]]},{"id":"fc53b31d.74bee","type":"influxdb in","z":"55276915.b6b808","influxdb":"ac69b075.a9d24","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":670,"y":60,"wires":[["d4f89fbf.c4394"]]},{"id":"ad4a6d0c.15611","type":"function","z":"55276915.b6b808","name":"","func":"msg.query =\"select * from Sensors_ext order by time DESC limit 20\" ;\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":60,"wires":[["fc53b31d.74bee"]]},{"id":"43bd8fce.62c75","type":"ui_button","z":"55276915.b6b808","name":"","group":"71d71016.b48c","order":1,"width":0,"height":0,"passthru":false,"label":"Capteur_ext","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":530,"y":20,"wires":[["ad4a6d0c.15611","ba96b160.013ec"]]},{"id":"a2bff448.d2d748","type":"change","z":"55276915.b6b808","name":"","rules":[{"t":"set","p":"toto","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":170,"y":200,"wires":[["fbfdf74d.8db098"]]},{"id":"f234512b.74976","type":"function","z":"55276915.b6b808","name":"","func":"if(msg.payload===null){\n    msg.payload=1;\n}\nmsg.payload =msg.payload*100;\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":240,"wires":[["a2bff448.d2d748"]]},{"id":"bb1b2fd7.662a6","type":"function","z":"55276915.b6b808","name":"","func":"var m = {};\nvar labels = []\nvar data = []\nvar time = [];\nvar time2 = [];\nvar hour=[],minutes=[],second=[];\nvar analog = [] ,luminosity = [],humidity=[],temperature=[];\n\nfor(i=0;i<msg.payload.length;i++){\nvar d = new Date(msg.payload[i].time);\nluminosity[i] = parseInt(msg.payload[i].Lum_int);\nhumidity[i] = parseInt(msg.payload[i].H_int);\ntemperature[i] = parseInt(msg.payload[i].T_int);\n\ntime[i] = msg.payload[i].time;\nhour[i] = d.getHours(msg.payload[i].time);\nminutes[i] = d.getMinutes(msg.payload[i].time);\nsecond[i] = d.getSeconds(msg.payload[i].time);\ntime2[i] = hour[i] +\"h\"+ minutes[i] +\"min\" + second[i] + \"s\";\n}\n    m.series = [\"Luminosity\",\"Humidity\",\"Temperature\"];\n    m.data = [luminosity,humidity,temperature];\n    m.labels = time2;\nreturn {\n    payload:[m] ,\n    topic : msg.topic\n    \n};","outputs":1,"noerr":0,"x":830,"y":180,"wires":[["cc868858.646ef8"]]},{"id":"cc1307ca.f9c208","type":"influxdb in","z":"55276915.b6b808","influxdb":"ac69b075.a9d24","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":670,"y":160,"wires":[["bb1b2fd7.662a6"]]},{"id":"50678c27.d05c74","type":"function","z":"55276915.b6b808","name":"","func":"msg.query =\"select * from Sensors_int order by time DESC limit 20\";\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":160,"wires":[["cc1307ca.f9c208"]]},{"id":"bef6fd0.f8677","type":"ui_button","z":"55276915.b6b808","name":"","group":"71d71016.b48c","order":2,"width":0,"height":0,"passthru":false,"label":"Capteur_int","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":530,"y":120,"wires":[["50678c27.d05c74","1a85bb3e.6c0385"]]},{"id":"cc868858.646ef8","type":"ui_chart","z":"55276915.b6b808","name":"","group":"cf928aa.09eed78","order":2,"width":0,"height":0,"label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1210,"y":220,"wires":[[]]},{"id":"d56c29cb.e030b8","type":"function","z":"55276915.b6b808","name":"","func":"var m = {};\nvar labels = []\nvar data = []\nvar time = [];\nvar time2 = [];\nvar hour=[],minutes=[],second=[];\nvar analog = [] ,luminosity = [],humidity=[],temperature=[];\n\nfor(i=0;i<msg.payload.length;i++){\nvar d = new Date(msg.payload[i].time);\nluminosity[i] = parseInt(msg.payload[i].Lum_serre);\nhumidity[i] = parseInt(msg.payload[i].H_serre);\ntemperature[i] = parseInt(msg.payload[i].T_serre);\n\ntime[i] = msg.payload[i].time;\nhour[i] = d.getHours(msg.payload[i].time);\nminutes[i] = d.getMinutes(msg.payload[i].time);\nsecond[i] = d.getSeconds(msg.payload[i].time);\ntime2[i] = hour[i] +\"h\"+ minutes[i] +\"min\" + second[i] + \"s\";\n}\n    m.series = [\"Luminosity\",\"Humidity\",\"Temperature\"];\n    m.data = [luminosity,humidity,temperature];\n    m.labels = time2;\nreturn {\n    payload:[m] ,\n    topic : msg.topic\n    \n};","outputs":1,"noerr":0,"x":830,"y":260,"wires":[["cc868858.646ef8"]]},{"id":"5d30839.6d77c7c","type":"influxdb in","z":"55276915.b6b808","influxdb":"ac69b075.a9d24","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":670,"y":260,"wires":[["d56c29cb.e030b8"]]},{"id":"abc828f7.42fa88","type":"function","z":"55276915.b6b808","name":"","func":"msg.query =\"select * from Sensors_Serre order by time DESC limit 20\" ;\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":260,"wires":[["5d30839.6d77c7c"]]},{"id":"325b84dd.d3c20c","type":"ui_button","z":"55276915.b6b808","name":"","group":"71d71016.b48c","order":3,"width":0,"height":0,"passthru":false,"label":"Capteur_Serre","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":540,"y":220,"wires":[["abc828f7.42fa88","1699fe3c.910d02"]]},{"id":"6b11233f.8e08ac","type":"function","z":"55276915.b6b808","name":"","func":"var m = {};\nvar labels = []\nvar data = []\nvar time = [];\nvar time2 = [];\nvar hour=[],minutes=[],second=[];\nvar analog = [] ,luminosity = [],humidity=[],temperature=[];\n\nfor(i=0;i<msg.payload.length;i++){\nvar d = new Date(msg.payload[i].time);\nluminosity[i] = parseInt(msg.payload[i].Lum_toto);\nhumidity[i] = parseInt(msg.payload[i].H_toto);\ntemperature[i] = parseInt(msg.payload[i].T_toto);\n\ntime[i] = msg.payload[i].time;\nhour[i] = d.getHours(msg.payload[i].time);\nminutes[i] = d.getMinutes(msg.payload[i].time);\nsecond[i] = d.getSeconds(msg.payload[i].time);\ntime2[i] = hour[i] +\"h\"+ minutes[i] +\"min\" + second[i] + \"s\";\n}\n    m.series = [\"Luminosity\",\"Humidity\",\"Temperature\"];\n    m.data = [luminosity,humidity,temperature];\n    m.labels = time2;\nreturn {\n    payload:[m] ,\n    topic : msg.topic\n    \n};","outputs":1,"noerr":0,"x":830,"y":360,"wires":[["cc868858.646ef8"]]},{"id":"234d96da.79a7aa","type":"influxdb in","z":"55276915.b6b808","influxdb":"ac69b075.a9d24","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":670,"y":360,"wires":[["6b11233f.8e08ac"]]},{"id":"dece252d.469ba8","type":"function","z":"55276915.b6b808","name":"","func":"msg.query =\"select * from Sensors_toto order by time DESC limit 20\" ;\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":360,"wires":[["234d96da.79a7aa"]]},{"id":"4aaa8b88.8d3004","type":"ui_button","z":"55276915.b6b808","name":"","group":"71d71016.b48c","order":4,"width":0,"height":0,"passthru":false,"label":"Capteur_toto","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":530,"y":320,"wires":[["dece252d.469ba8","4c9b6881.c1bba8"]]},{"id":"3ef0e30f.5b75cc","type":"function","z":"55276915.b6b808","name":"","func":"var m = {};\nvar labels = [];\nvar data = []\nvar time = [];\nvar time2 = [];\nvar hour=[],minutes=[],second=[];\nvar analog = [] ,luminosity = [],humidity=[],temperature=[];\n\nfor(i=0;i<msg.payload.length;i++){\nvar d = new Date(msg.payload[i].time);\nluminosity[i] = parseInt(msg.payload[i].Lum_smartcampus);\nhumidity[i] = parseInt(msg.payload[i].H_smartcampus);\ntemperature[i] = parseInt(msg.payload[i].T_smartcampus);\n\ntime[i] = msg.payload[i].time;\nhour[i] = d.getHours(msg.payload[i].time);\nminutes[i] = d.getMinutes(msg.payload[i].time);\nsecond[i] = d.getSeconds(msg.payload[i].time);\ntime2[i] = hour[i] +\"h\"+ minutes[i] +\"min\" + second[i] + \"s\";\n}\n    m.series = [\"Luminosity\",\"Humidity\",\"Temperature\"];\n    m.data = [luminosity,humidity,temperature];\n    m.labels = time2;\nreturn {\n    payload:[m] ,\n    topic : msg.topic\n    \n};","outputs":1,"noerr":0,"x":830,"y":460,"wires":[["cc868858.646ef8"]]},{"id":"218f733e.31a32c","type":"influxdb in","z":"55276915.b6b808","influxdb":"ac69b075.a9d24","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":670,"y":460,"wires":[["3ef0e30f.5b75cc"]]},{"id":"65ce7af5.fdfc64","type":"function","z":"55276915.b6b808","name":"","func":"msg.query =\"select * from Sensors_smartcampus order by time DESC limit 20\";\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":460,"wires":[["218f733e.31a32c"]]},{"id":"2246defd.ea9652","type":"ui_button","z":"55276915.b6b808","name":"","group":"71d71016.b48c","order":5,"width":0,"height":0,"passthru":false,"label":"Capteur_smartcampus","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":560,"y":420,"wires":[["65ce7af5.fdfc64","19f98488.dc84cb"]]},{"id":"20f4cc2a.df1954","type":"ui_button","z":"55276915.b6b808","name":"","group":"71d71016.b48c","order":7,"width":0,"height":0,"passthru":false,"label":"Clear","tooltip":"","color":"","bgcolor":"","icon":"","payload":"[]","payloadType":"json","topic":"","x":810,"y":620,"wires":[["cc868858.646ef8"]]},{"id":"8babafb3.cbdad","type":"function","z":"55276915.b6b808","name":"","func":"msg.query =\"select * from dist order by time desc limit 50\"\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":560,"wires":[["2aee08de.c5a018"]]},{"id":"2aee08de.c5a018","type":"influxdb in","z":"55276915.b6b808","influxdb":"ac69b075.a9d24","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":650,"y":560,"wires":[["385b6857.6e78f8"]]},{"id":"385b6857.6e78f8","type":"function","z":"55276915.b6b808","name":"","func":"var m = {};\nvar labels = []\nvar data = [];\nvar series = []\nvar i=0;\nvar j=0;\nvar a;\nwhile(i<msg.payload.length-1){\n    if(msg.payload[i+1].RSSI !== null && msg.payload[i].alt!==null){\n      data[j] = msg.payload[i+1].RSSI;\n      labels[j] = parseInt(msg.payload[i].alt/1000);\n      j++;\n      i++;}\nelse{ i++;}}\n\nfor(i=0;i<labels.length;i++){\n    for(j=0;j<labels.length-i-1;j++){\n        if(labels[j]>labels[j+1]){\n            a=labels[j];\n            labels[j]=labels[j+1];\n            labels[j+1]=a;\n            a=data[j];\n            data[j]=data[j+1];\n            data[j+1]=a;\n            \n        }\n    }\n}\n\n\n    m.series = 'X';\n    m.labels = labels;\n    m.data = [data];\n    m.size = '24x24';\n\nreturn {\n    payload:[m] ,\n    topic : msg.topic\n    \n};\n","outputs":1,"noerr":0,"x":810,"y":560,"wires":[["cc868858.646ef8"]]},{"id":"81fc7310.28c6b","type":"ui_button","z":"55276915.b6b808","name":"","group":"71d71016.b48c","order":6,"width":0,"height":0,"passthru":false,"label":"RFID/Elevation","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":520,"y":520,"wires":[["8babafb3.cbdad"]]},{"id":"fbfdf74d.8db098","type":"debug","z":"55276915.b6b808","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":180,"y":140,"wires":[]},{"id":"b96f1305.aa61c","type":"ui_text","z":"55276915.b6b808","group":"cf928aa.09eed78","order":1,"width":0,"height":0,"name":"","label":"Nom Chart","format":"{{msg.text}}","layout":"row-spread","x":1230,"y":160,"wires":[]},{"id":"ba96b160.013ec","type":"function","z":"55276915.b6b808","name":"","func":"msg.text = \"Capteur_ext\"\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":20,"wires":[["b96f1305.aa61c"]]},{"id":"1a85bb3e.6c0385","type":"function","z":"55276915.b6b808","name":"","func":"msg.text = \"Capteur_int\"\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":120,"wires":[["b96f1305.aa61c"]]},{"id":"1699fe3c.910d02","type":"function","z":"55276915.b6b808","name":"","func":"msg.text = \"Capteur_Serre\"\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":220,"wires":[["b96f1305.aa61c"]]},{"id":"4c9b6881.c1bba8","type":"function","z":"55276915.b6b808","name":"","func":"msg.text = \"Capteur_toto\"\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":320,"wires":[["b96f1305.aa61c"]]},{"id":"19f98488.dc84cb","type":"function","z":"55276915.b6b808","name":"","func":"msg.text = \"Capteur_smartcampus\"\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":420,"wires":[["b96f1305.aa61c"]]},{"id":"701bad3b.edbef4","type":"function","z":"55276915.b6b808","name":"","func":"msg.query =\"select * from dist order by time desc limit 50\"\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":720,"wires":[["e8e3d0d4.244e"]]},{"id":"e8e3d0d4.244e","type":"influxdb in","z":"55276915.b6b808","influxdb":"ac69b075.a9d24","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":630,"y":720,"wires":[["b3d21456.a079d8"]]},{"id":"b3d21456.a079d8","type":"function","z":"55276915.b6b808","name":"","func":"var m = {};\nvar labels = []\nvar data = [];\nvar series = []\nvar i=0;\nvar j=0;\nvar a;\nwhile(i<msg.payload.length-1){\n    if(msg.payload[i+1].RSSI !== null && msg.payload[i].alt!==null){\n      data[j] = msg.payload[i+1].RSSI;\n      labels[j] = parseInt(msg.payload[i].lat);\n      j++;\n      i++;}\nelse{ i++;}}\n\nfor(i=0;i<labels.length;i++){\n    for(j=0;j<labels.length-i-1;j++){\n        if(labels[j]>labels[j+1]){\n            a=labels[j];\n            labels[j]=labels[j+1];\n            labels[j+1]=a;\n            a=data[j];\n            data[j]=data[j+1];\n            data[j+1]=a;\n            \n        }\n    }\n}\n\n\n    m.series = 'X';\n    m.labels = labels;\n    m.data = [data];\n    m.size = '24x24';\n\nreturn {\n    payload:[m] ,\n    topic : msg.topic\n    \n};\n","outputs":1,"noerr":0,"x":790,"y":720,"wires":[["cc868858.646ef8"]]},{"id":"c7be5b39.57a5b8","type":"ui_button","z":"55276915.b6b808","name":"","group":"71d71016.b48c","order":6,"width":0,"height":0,"passthru":false,"label":"Lat/Elevation","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":490,"y":680,"wires":[["701bad3b.edbef4"]]},{"id":"5017dadb.a5f9d4","type":"function","z":"55276915.b6b808","name":"","func":"msg.query =\"select * from dist order by time desc limit 50\"\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":840,"wires":[["1d1419e3.8f1a66"]]},{"id":"1d1419e3.8f1a66","type":"influxdb in","z":"55276915.b6b808","influxdb":"ac69b075.a9d24","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":630,"y":840,"wires":[["1cd616a4.8f1019"]]},{"id":"1cd616a4.8f1019","type":"function","z":"55276915.b6b808","name":"","func":"var m = {};\nvar labels = []\nvar data = [];\nvar series = []\nvar i=0;\nvar j=0;\nvar a;\nwhile(i<msg.payload.length-1){\n    if(msg.payload[i+1].RSSI !== null && msg.payload[i].alt!==null){\n      data[j] = msg.payload[i+1].RSSI;\n      labels[j] = parseInt(msg.payload[i].lon);\n      j++;\n      i++;}\nelse{ i++;}}\n\nfor(i=0;i<labels.length;i++){\n    for(j=0;j<labels.length-i-1;j++){\n        if(labels[j]>labels[j+1]){\n            a=labels[j];\n            labels[j]=labels[j+1];\n            labels[j+1]=a;\n            a=data[j];\n            data[j]=data[j+1];\n            data[j+1]=a;\n            \n        }\n    }\n}\n\n\n    m.series = 'X';\n    m.labels = labels;\n    m.data = [data];\n    m.size = '24x24';\n\nreturn {\n    payload:[m] ,\n    topic : msg.topic\n    \n};\n","outputs":1,"noerr":0,"x":790,"y":840,"wires":[["cc868858.646ef8","b96f1305.aa61c"]]},{"id":"737740e5.f7274","type":"ui_button","z":"55276915.b6b808","name":"","group":"71d71016.b48c","order":6,"width":0,"height":0,"passthru":false,"label":"Lon/Elevation","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":500,"y":800,"wires":[["5017dadb.a5f9d4"]]},{"id":"21fdba66.6dbfa6","type":"http request","z":"e7ba57b9.797718","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"https://celestrak.com/satcat/tle.php?CATNR=44109","tls":"","persist":false,"proxy":"","authType":"","x":250,"y":140,"wires":[["f91b0973.58c248"]]},{"id":"f91b0973.58c248","type":"split","z":"e7ba57b9.797718","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":250,"y":180,"wires":[["295f7c98.e3afc4"]]},{"id":"90661891.712978","type":"tle","z":"e7ba57b9.797718","satid":"","tle1":"","tle2":"","coordsys":"latlongdeg","name":"MP6","x":250,"y":540,"wires":[["f53fd138.90a8b","f6e81921.49b478","bea25cd0.bb06c"]]},{"id":"f53fd138.90a8b","type":"debug","z":"e7ba57b9.797718","name":"Message coming out of TLE node","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":500,"y":540,"wires":[]},{"id":"295f7c98.e3afc4","type":"switch","z":"e7ba57b9.797718","name":"","property":"parts.index","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":4,"x":250,"y":240,"wires":[["7f533946.e8a278"],["eef54572.036218"],["fa22fad7.0f7918"],["a3f50b67.c71f98"]]},{"id":"7f533946.e8a278","type":"change","z":"e7ba57b9.797718","name":"","rules":[{"t":"set","p":"satid","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":300,"wires":[["ea6273fd.8129a"]]},{"id":"eef54572.036218","type":"change","z":"e7ba57b9.797718","name":"","rules":[{"t":"set","p":"tle1","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":340,"wires":[["ea6273fd.8129a"]]},{"id":"fa22fad7.0f7918","type":"change","z":"e7ba57b9.797718","name":"","rules":[{"t":"set","p":"tle2","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":380,"wires":[["ea6273fd.8129a"]]},{"id":"ea6273fd.8129a","type":"join","z":"e7ba57b9.797718","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":250,"y":460,"wires":[["c5bd6f18.8ea95"]]},{"id":"a3f50b67.c71f98","type":"change","z":"e7ba57b9.797718","name":"set timestamp","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":420,"wires":[["ea6273fd.8129a"]]},{"id":"c5bd6f18.8ea95","type":"change","z":"e7ba57b9.797718","name":"put timestamp back in payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"timestamp","tot":"msg"},{"t":"delete","p":"timestamp","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":500,"wires":[["90661891.712978"]]},{"id":"f6e81921.49b478","type":"function","z":"e7ba57b9.797718","name":"","func":"msg.payload={\n    name : msg.payload.name,\n    lat : msg.payload.position.lat,\n    lon : msg.payload.position.lon,\n    alt : msg.payload.position.alt,\n    label : \"Lastest position\",\n    content :  msg.payload.name\n}\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":580,"wires":[["2076fa27.26b416"]]},{"id":"2076fa27.26b416","type":"worldmap","z":"e7ba57b9.797718","name":"","lat":"","lon":"","zoom":"","layer":"","cluster":"","maxage":"","usermenu":"show","layers":"show","panit":"false","panlock":"false","zoomlock":"false","hiderightclick":"false","coords":"none","showgrid":"false","path":"/worldmap","x":440,"y":580,"wires":[]},{"id":"bea25cd0.bb06c","type":"function","z":"e7ba57b9.797718","name":"","func":"\nmsg.payload ={\n        x : msg.payload.position.x,\n        y : msg.payload.position.y,\n        z : msg.payload.position.z,\n        lat : msg.payload.position.lat,\n        lon : msg.payload.position.lon,\n        alt : msg.payload.position.alt,\n        \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":400,"wires":[["f31e469.13a59b8","864577d.3d6d688"]]},{"id":"e1b95104.692f2","type":"influxdb out","z":"e7ba57b9.797718","influxdb":"727410bf.71376","name":"","measurement":"coo","precision":"","retentionPolicy":"","x":1120,"y":360,"wires":[]},{"id":"f31e469.13a59b8","type":"influxdb out","z":"e7ba57b9.797718","influxdb":"727410bf.71376","name":"","measurement":"dist","precision":"","retentionPolicy":"","x":1100,"y":400,"wires":[]},{"id":"3b722bac.ba60d4","type":"complete","z":"e7ba57b9.797718","name":"","scope":["8fda2746.8535b8"],"uncaught":false,"x":490,"y":20,"wires":[[]]},{"id":"c51569e2.e862a8","type":"ttn uplink","z":"e7ba57b9.797718","name":"test","app":"614e7de9.9f91a4","dev_id":"test","field":"","x":650,"y":40,"wires":[["72d8971a.0c7c08","8fda2746.8535b8","6d49ffd4.19aff","39c074d9.90772c"]]},{"id":"72d8971a.0c7c08","type":"function","z":"e7ba57b9.797718","name":"","func":"var gatewaysarray = msg.metadata.gateways;\nvar rssi = [];\nvar logMsgs = [];\nvar moy;\n\nfor (i = 0; i < gatewaysarray.length; i++){\n    rssi[i]= gatewaysarray[i].rssi;}\n    moy = (rssi[0]+rssi[1])/2;\n\nmsg.payload ={\n       Accx : msg.payload.accx,\n       Accy : msg.payload.accy,\n       Accz : msg.payload.accz,\n       Humidity : msg.payload.humidity,\n       Lacuna_Sat : msg.payload.lacuna_sat,\n       Lat : msg.payload.lat,\n       Lon : msg.payload.lng,\n       Length : msg.payload.length,\n       Pressure : msg.payload.pressure,\n       Temp : msg.payload.temperature,\n       Tleage : msg.payload.tleage,\n       TTF : msg.payload.ttf,\n       Voltage : msg.payload.voltage,\n       Voltage_adc : msg.payload.voltage_adc,\n       Lacuna_sat : msg.payload.lacuna_sat,\n       RSSI : moy\n}\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":40,"wires":[["5e0821d4.2d018"]]},{"id":"5e0821d4.2d018","type":"influxdb out","z":"e7ba57b9.797718","influxdb":"727410bf.71376","name":"","measurement":"Test","precision":"","retentionPolicy":"","x":980,"y":40,"wires":[]},{"id":"8fda2746.8535b8","type":"function","z":"e7ba57b9.797718","name":"Complete","func":"var gatewaysarray = msg.metadata.gateways;\nvar rssi = [];\nvar logMsgs = [];\nvar moy;\n\nfor (i = 0; i < gatewaysarray.length; i++){\n    rssi[i]= gatewaysarray[i].rssi;}\n    moy = (rssi[0]+rssi[1])/2;\n\n\n\nmsg.payload ={\n        Accx : msg.payload.accx,\n        Accy : msg.payload.accy,\n        Accz : msg.payload.accz,\n        RSSI : moy\n}\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":80,"wires":[["f16fbe41.8a307"]]},{"id":"f16fbe41.8a307","type":"influxdb out","z":"e7ba57b9.797718","influxdb":"727410bf.71376","name":"","measurement":"dist","precision":"","retentionPolicy":"","x":980,"y":80,"wires":[]},{"id":"60149e3d.e25c1","type":"function","z":"e7ba57b9.797718","name":"Query","func":"msg.query = \"select * from dist order by time DESC limit 2\"\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":240,"wires":[["e38653f.77e35b"]]},{"id":"e38653f.77e35b","type":"influxdb in","z":"e7ba57b9.797718","influxdb":"727410bf.71376","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":510,"y":280,"wires":[["2e88f082.19f03"]]},{"id":"2e88f082.19f03","type":"function","z":"e7ba57b9.797718","name":"Calcul Distance","func":"var x2 = msg.payload[1].Accx;\nvar y2 = msg.payload[1].Accy;\nvar z2 = msg.payload[1].Accz;\nvar x1 = msg.payload[0].x;\nvar y1 = msg.payload[0].y;\nvar z1 = msg.payload[0].z;\nmsg.payload ={\n  Distance : (x1*x1-x2*x2)+(y1*y1-y2*y2)+\n  (z1*z1-z2*z2),\n}\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":320,"wires":[["e3531187.e3d5c"]]},{"id":"e3531187.e3d5c","type":"calculator","z":"e7ba57b9.797718","name":"","inputMsgField":"payload.Distance","outputMsgField":"payload.Distance","operation":"sqrt","constant":"","x":510,"y":360,"wires":[["3122b9fa.c15996","c8b7982c.e72208"]]},{"id":"3122b9fa.c15996","type":"debug","z":"e7ba57b9.797718","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":510,"y":400,"wires":[]},{"id":"9bca6e93.db954","type":"complete","z":"e7ba57b9.797718","name":"","scope":["bea25cd0.bb06c"],"uncaught":false,"x":510,"y":200,"wires":[["60149e3d.e25c1"]]},{"id":"a0d01014.d0544","type":"inject","z":"e7ba57b9.797718","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":40,"wires":[["21fdba66.6dbfa6"]]},{"id":"11f79456.c9f74c","type":"function","z":"e7ba57b9.797718","name":"Compute device List","func":"msg.payload = {};\nif(msg.index<msg.max)\n{\n    msg.query=\"select * from coo where lat = \" +msg.toto[msg.index].lat+ \"order by time DESC limit 1\"\n    msg.index++;\n    return msg;\n}\n","outputs":1,"noerr":0,"x":520,"y":700,"wires":[["f581be89.5742f"]]},{"id":"f581be89.5742f","type":"influxdb in","z":"e7ba57b9.797718","influxdb":"727410bf.71376","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":710,"y":700,"wires":[["aebccc95.e66bc"]]},{"id":"aebccc95.e66bc","type":"switch","z":"e7ba57b9.797718","name":"","property":"payload[0]","propertyType":"msg","rules":[{"t":"null"},{"t":"nnull"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":800,"wires":[["11f79456.c9f74c"],["75b41a5d.9cd7c4"]]},{"id":"75b41a5d.9cd7c4","type":"function","z":"e7ba57b9.797718","name":"","func":"var iconColor;\nvar Command\nif(msg.payload[0].RSSI<=-82){\n    iconColor = \"red\";\n}\nelse if(msg.payload[0].RSSI<=-80)\n{\n    iconColor = \"orange\";\n}\nelse if(msg.payload[0].RSSI<=-78){\n    iconColor = \"purple\";\n}else {\n        iconColor = \"blue\";\n\n}\n\nmsg.payload ={\n    name : \"M6P\"+ msg.index,\n    lat : msg.payload[0].lat,\n    lon : msg.payload[0].lon,\n    label : \"\"+msg.index,\n    RSSi : msg.payload[0].RSSI,\n    iconColor : iconColor,\n    Distance : msg.payload[0].Distance,\n    layer : \"drawing\",\n    \"button\": { \"name\":\"My Fancy Button\", \"icon\": \"fa-star\", \"position\":\"bottomright\" },\n    line : [[43.716372, 7.126737] , [msg.payload[0].lat,msg.payload[0].lon]]\n}\nreturn msg;\n\n\n","outputs":1,"noerr":0,"x":910,"y":800,"wires":[["11f79456.c9f74c","6173ca09.5b2c94","bf93d1ad.495cc"]]},{"id":"3d217dcd.166bb2","type":"inject","z":"e7ba57b9.797718","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":260,"y":660,"wires":[["5f85da2e.c1ae14"]]},{"id":"5f85da2e.c1ae14","type":"influxdb in","z":"e7ba57b9.797718","influxdb":"727410bf.71376","name":"","query":"select * from coo order by time DESC","rawOutput":false,"precision":"","retentionPolicy":"","x":670,"y":660,"wires":[["db0f1b73.7c0c88"]]},{"id":"db0f1b73.7c0c88","type":"function","z":"e7ba57b9.797718","name":"","func":"msg.index=0;\nmsg.max = 0;\nmsg.toto=msg.payload;\n\n//Rentrer la date que vous souhaitez afficher\ndate = \"4/3/2020\"\nvar time = [];\nvar time2 = [];\nvar hour=[],minutes=[],second=[],ia=0,ib=0;\n\nfor(i=0;i<msg.payload.length;i++){\nvar d = new Date(msg.payload[i].time);\ntime[i] = msg.payload[i].time;\nhour[i] = d.getDay(msg.payload[i].time);\nminutes[i] = d.getMonth(msg.payload[i].time);\nsecond[i] = d.getFullYear(msg.payload[i].time);\ntime2[i] = hour[i] +\"/\"+ minutes[i] +\"/\" + second[i] ;\n}\nwhile(date !== time2[msg.index])\n{\n    msg.index++;\n\n}\nfor(i=0;i<msg.payload.length;i++){\n    if(date == time2[i])\n    {\n       msg.max = i ;\n    }\n}\nmsg.payload={\n    dates:time2\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":930,"y":660,"wires":[["11f79456.c9f74c","16616748.5e4ca9","549d30b3.7ae2","f3918946.a35ab8"]]},{"id":"6d49ffd4.19aff","type":"function","z":"e7ba57b9.797718","name":"","func":"\nvar rssi = [];\nvar rssii;\nvar logMsgs = [];\nvar moy;\nif(msg.metadata === undefined){\n    \n    rssii = msg.payload[0].RSSI;\n    msg.payload ={\n    RSSI : rssii,\n    }\n} else {\n    var gatewaysarray = msg.metadata.gateways;\nfor (i = 0; i < gatewaysarray.length; i++){\n    rssi[i]= gatewaysarray[i].rssi;}\n    moy = (rssi[0]+rssi[1])/2;\n    msg.payload ={\n        RSSI : moy,\n       \n    }\n}\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":320,"wires":[["864577d.3d6d688"]]},{"id":"864577d.3d6d688","type":"join","z":"e7ba57b9.797718","name":"","mode":"custom","build":"merged","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"10s","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":930,"y":360,"wires":[["e1b95104.692f2"]]},{"id":"6173ca09.5b2c94","type":"debug","z":"e7ba57b9.797718","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1260,"y":740,"wires":[]},{"id":"bf93d1ad.495cc","type":"worldmap","z":"e7ba57b9.797718","name":"","lat":"","lon":"","zoom":"","layer":"","cluster":"","maxage":"","usermenu":"show","layers":"show","panit":"false","panlock":"false","zoomlock":"false","hiderightclick":"false","coords":"false","showgrid":"false","path":"/worldmap","x":1300,"y":820,"wires":[]},{"id":"c8b7982c.e72208","type":"function","z":"e7ba57b9.797718","name":"","func":"msg.payload = msg.payload;\nmsg.complete = true;\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":360,"wires":[["864577d.3d6d688"]]},{"id":"9d12ddd4.d04d","type":"influxdb in","z":"e7ba57b9.797718","influxdb":"727410bf.71376","name":"","query":"select * from dist where RSSI != 0 order by time DESC limit 1 ","rawOutput":false,"precision":"","retentionPolicy":"","x":880,"y":140,"wires":[["6d49ffd4.19aff"]]},{"id":"39c074d9.90772c","type":"debug","z":"e7ba57b9.797718","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1190,"y":40,"wires":[]},{"id":"39c19b3a.ecff04","type":"function","z":"e7ba57b9.797718","name":"","func":"\n//Rentrer la date que vous souhaitez afficher\ndate = \"4/3/2020\"\nvar time = [];\nvar time2 = [];\nvar hour=[],minutes=[],second=[],ia=0,ib=0;\n\nfor(i=0;i<msg.payload.length;i++){\nvar d = new Date(msg.payload[i].time);\ntime[i] = msg.payload[i].time;\nhour[i] = d.getDay(msg.payload[i].time);\nminutes[i] = d.getMonth(msg.payload[i].time);\nsecond[i] = d.getFullYear(msg.payload[i].time);\ntime2[i] = hour[i] +\"/\"+ minutes[i] +\"/\" + second[i] ;\n}\nwhile(date !== time2[ia])\n{\n    ia++;\n\n}\nfor(i=0;i<msg.payload.length;i++){\n    if(date == time2[i])\n    {\n       ib = i ;\n    }\n}\nmsg.payload={\n    ia:ia,\n    ib:ib,\n    dates:time2\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":710,"y":1080,"wires":[["dbc105d1.a775e8"]]},{"id":"ac11c16.7726d4","type":"inject","z":"e7ba57b9.797718","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":1100,"wires":[["2ea0a600.13086a"]]},{"id":"dbc105d1.a775e8","type":"debug","z":"e7ba57b9.797718","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":830,"y":1120,"wires":[]},{"id":"2ea0a600.13086a","type":"influxdb in","z":"e7ba57b9.797718","influxdb":"727410bf.71376","name":"","query":"select * from dist order by time DESC ","rawOutput":false,"precision":"","retentionPolicy":"","x":410,"y":1120,"wires":[["39c19b3a.ecff04"]]},{"id":"a801e4bb.187a68","type":"debug","z":"e7ba57b9.797718","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":520,"y":980,"wires":[]},{"id":"16616748.5e4ca9","type":"debug","z":"e7ba57b9.797718","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"toto","targetType":"msg","x":1140,"y":540,"wires":[]},{"id":"549d30b3.7ae2","type":"debug","z":"e7ba57b9.797718","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"index","targetType":"msg","x":1200,"y":620,"wires":[]},{"id":"f3918946.a35ab8","type":"debug","z":"e7ba57b9.797718","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"max","targetType":"msg","x":1090,"y":500,"wires":[]},{"id":"20460399.39046c","type":"debug","z":"e7ba57b9.797718","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":520,"y":120,"wires":[]},{"id":"fec88650.3431a8","type":"time-switch","z":"e7ba57b9.797718","name":"","lat":"43.71907","lon":"7.12376","startTime":"20:06","endTime":"20:07","startOffset":0,"endOffset":0,"x":250,"y":80,"wires":[["21fdba66.6dbfa6"],[]]},{"id":"b27f00f.bee8b","type":"function","z":"728ebd67.6f43d4","name":"Process received TTN message","func":"//process new message which may contain the response\n//of multiple gateways which received the packet\nvar gatewaysarray = msg.metadata.gateways;\nvar logMsgs = [];\nvar time= gatewaysarray[0].time;\nvar gw_id = [];\nvar rssi = [];\nvar snr = [];\nvar gw_lat = [];\nvar gw_lon = [];\nvar gw_alt = [];\nvar timestamp = [];\nfor (i = 0; i < gatewaysarray.length; i++){\n\ngw_id[i] = gatewaysarray[i].gtw_id;\nrssi[i]= gatewaysarray[i].rssi;\nsnr[i] = gatewaysarray[i].snr;\ngw_lat[i] = gatewaysarray[i].latitude;\ngw_lon[i] = gatewaysarray[i].longitude;\ngw_alt[i] = gatewaysarray[i].altitude;\ntimestamp[i]= gatewaysarray[i].timestamp;\nlogMsgs[i]=({payload: {time: time,\n                           gtw_id: gw_id,\n                           rssi: rssi,\n                           snr: snr,\n                           gwy_lat: gw_lat,\n                           gwy_lon: gw_lon,\n                           gwy_alt: gw_alt,\n                           timestamp : timestamp\n                            }\n                 });\n   }\nreturn logMsgs;\n\n\n","outputs":1,"noerr":0,"x":510,"y":180,"wires":[["a02347f9.389188"]]},{"id":"a02347f9.389188","type":"csv","z":"728ebd67.6f43d4","name":"To CSV","sep":",","hdrin":"","hdrout":"","multi":"one","ret":"\\n","temp":"time,gtw_id,rssi,snr,gwy_lat,gwy_lon,gwy_alt,timestamp","skip":0,"strings":true,"x":777,"y":181,"wires":[["69004f84.a05b6"]]},{"id":"69004f84.a05b6","type":"file","z":"728ebd67.6f43d4","name":"","filename":"GW_test.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":930,"y":260,"wires":[[]]},{"id":"769a6f7f.fb6ca","type":"ttn uplink","z":"728ebd67.6f43d4","name":"Lacuna_test","app":"bc580014.0e55","dev_id":"test","field":"","x":70,"y":159,"wires":[["b27f00f.bee8b","2cd98667.5a790a","2312d2f3.7f1aae"]]},{"id":"2cd98667.5a790a","type":"debug","z":"728ebd67.6f43d4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":926.000057220459,"y":102.99999809265137,"wires":[]},{"id":"2312d2f3.7f1aae","type":"influxdb out","z":"728ebd67.6f43d4","influxdb":"185529ad.ef9206","name":"","measurement":"test","precision":"","retentionPolicy":"","x":660,"y":300,"wires":[]},{"id":"732ca8fa.5cca58","type":"function","z":"728ebd67.6f43d4","name":"Process received TTN message","func":"//process new message which may contain the response\n//of multiple gateways which received the packet\nvar gatewaysarray = msg.metadata.gateways;\nvar logMsgs = [];\nvar time= gatewaysarray[0].time;\nvar gw_id = [];\nvar rssi = [];\nvar snr = [];\nvar gw_lat = [];\nvar gw_lon = [];\nvar gw_alt = [];\nvar timestamp = [];\nfor (i = 0; i < gatewaysarray.length; i++){\n\ngw_id[i] = gatewaysarray[i].gtw_id;\nrssi[i]= gatewaysarray[i].rssi;\nsnr[i] = gatewaysarray[i].snr;\ngw_lat[i] = gatewaysarray[i].latitude;\ngw_lon[i] = gatewaysarray[i].longitude;\ngw_alt[i] = gatewaysarray[i].altitude;\ntimestamp[i]= gatewaysarray[i].timestamp;\nlogMsgs[i]=({payload: {time: time,\n                           gtw_id: gw_id,\n                           rssi: rssi,\n                           snr: snr,\n                           gwy_lat: gw_lat,\n                           gwy_lon: gw_lon,\n                           gwy_alt: gw_alt,\n                           timestamp : timestamp\n                            }\n                 });\n   }\nreturn logMsgs;\n\n\n","outputs":1,"noerr":0,"x":510,"y":520,"wires":[["6a99a875.e55b48"]]},{"id":"6a99a875.e55b48","type":"csv","z":"728ebd67.6f43d4","name":"To CSV","sep":",","hdrin":"","hdrout":"","multi":"one","ret":"\\n","temp":"time,gtw_id,rssi,snr,gwy_lat,gwy_lon,gwy_alt,timestamp","skip":0,"strings":true,"x":777,"y":521,"wires":[["d21beb97.8bb3c8"]]},{"id":"d21beb97.8bb3c8","type":"file","z":"728ebd67.6f43d4","name":"","filename":"GW_test2.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":1007,"y":558,"wires":[[]]},{"id":"ea45daa5.a54488","type":"ttn uplink","z":"728ebd67.6f43d4","name":"Lacuna_test","app":"bc580014.0e55","dev_id":"test2","field":"","x":70,"y":499,"wires":[["732ca8fa.5cca58","9fecbd4f.c5341","b7739985.fe1598"]]},{"id":"9fecbd4f.c5341","type":"debug","z":"728ebd67.6f43d4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":926.000057220459,"y":442.99999809265137,"wires":[]},{"id":"b7739985.fe1598","type":"influxdb out","z":"728ebd67.6f43d4","influxdb":"185529ad.ef9206","name":"","measurement":"test","precision":"","retentionPolicy":"","x":660,"y":660,"wires":[]},{"id":"17c61a3.a0b33e6","type":"split","z":"46051912.a9cae8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":570,"y":180,"wires":[["752d792b.f7eb98"]]},{"id":"e1e7e471.1cb458","type":"tle","z":"46051912.a9cae8","satid":"","tle1":"","tle2":"","coordsys":"latlongdeg","name":"MP6","x":570,"y":540,"wires":[[]]},{"id":"752d792b.f7eb98","type":"switch","z":"46051912.a9cae8","name":"","property":"parts.index","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":4,"x":590,"y":240,"wires":[["b5967243.03b45"],["be46cafe.3cfcf8"],["4b13fe82.3b73f"],["677303bc.c0146c"]]},{"id":"b5967243.03b45","type":"change","z":"46051912.a9cae8","name":"","rules":[{"t":"set","p":"satid","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":300,"wires":[["f273620e.59e63"]]},{"id":"be46cafe.3cfcf8","type":"change","z":"46051912.a9cae8","name":"","rules":[{"t":"set","p":"tle1","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":340,"wires":[["f273620e.59e63"]]},{"id":"4b13fe82.3b73f","type":"change","z":"46051912.a9cae8","name":"","rules":[{"t":"set","p":"tle2","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":380,"wires":[["f273620e.59e63"]]},{"id":"f273620e.59e63","type":"join","z":"46051912.a9cae8","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":570,"y":460,"wires":[["f5e3aec1.d1282"]]},{"id":"677303bc.c0146c","type":"change","z":"46051912.a9cae8","name":"set timestamp","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":420,"wires":[["f273620e.59e63"]]},{"id":"f5e3aec1.d1282","type":"change","z":"46051912.a9cae8","name":"put timestamp back in payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"timestamp","tot":"msg"},{"t":"delete","p":"timestamp","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":500,"wires":[["e1e7e471.1cb458"]]},{"id":"4d0fd5bf.f1538c","type":"function","z":"59de1744.528cf8","name":"Query","func":"msg.query = \"select * from dist order by time DESC limit 2\"\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":260,"wires":[["3531af1c.85de5"]]},{"id":"3531af1c.85de5","type":"influxdb in","z":"59de1744.528cf8","influxdb":"4d05bc48.c82d84","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":630,"y":300,"wires":[["d45ba758.f76828"]]},{"id":"d45ba758.f76828","type":"function","z":"59de1744.528cf8","name":"Calcul Distance","func":"var x2 = msg.payload[1].Accx;\nvar y2 = msg.payload[1].Accy;\nvar z2 = msg.payload[1].Accz;\nvar x1 = msg.payload[0].x;\nvar y1 = msg.payload[0].y;\nvar z1 = msg.payload[0].z;\nmsg.payload ={\n  Distance : (x1*x1-x2*x2)+(y1*y1-y2*y2)+\n  (z1*z1-z2*z2),\n}\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":340,"wires":[["69195511.7d424c"]]},{"id":"69195511.7d424c","type":"calculator","z":"59de1744.528cf8","name":"","inputMsgField":"payload.Distance","outputMsgField":"payload.Distance","operation":"sqrt","constant":"","x":630,"y":380,"wires":[[]]},{"id":"ecaa76a3.e50a28","type":"http request","z":"f152842b.3e7d48","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"https://celestrak.com/satcat/tle.php?CATNR=44109","tls":"","persist":false,"proxy":"","authType":"","x":135,"y":300,"wires":[["b1f90abe.e7e518"]],"l":false},{"id":"b34bcc6e.3e0ea","type":"function","z":"f152842b.3e7d48","name":"","func":"msg.payload={\n    name : msg.payload.name,\n    lat : msg.payload.position.lat,\n    lon : msg.payload.position.lon,\n    alt : msg.payload.position.alt,\n    label : \"Lastest position\",\n    content :  msg.payload.name\n}\nreturn msg;","outputs":1,"noerr":0,"x":135,"y":380,"wires":[["e1681f7d.31acb"]],"l":false},{"id":"e1681f7d.31acb","type":"worldmap","z":"f152842b.3e7d48","name":"","lat":"","lon":"","zoom":"","layer":"","cluster":"","maxage":"","usermenu":"show","layers":"show","panit":"false","panlock":"false","zoomlock":"false","hiderightclick":"false","coords":"none","showgrid":"false","path":"/worldmap","x":135,"y":420,"wires":[],"l":false},{"id":"384150d5.8d148","type":"function","z":"f152842b.3e7d48","name":"","func":"//Dates = msg.headers.date;\nDates = msg.payload.timestamp+3600*5*24;\nvar d = new Date(Dates);\nSeconde = d.getUTCSeconds(Dates); //Retrieve seconds from our time\nMinute = d.getUTCMinutes(Dates);  //Retrieve minutes from our time\nHeure = d.getUTCHours(Dates);   //Retrieve hours from our time\nJour = d.getUTCDay(Dates);  //Retrieve days from our time\nMois= d.getUTCMonth(Dates)+1;  //Retrieve months from our time\nAnnee = d.getUTCFullYear(Dates);  //Retrieve years from our time\ntimes_d = Jour+\"/\"+Mois+\"/\"+Annee;\ntimes_h = Heure+\":\"+Minute+\":\"+Seconde; //Create a string compose by Day/Month/Year for each points\nmsg.payload ={\n        lat : msg.payload.position.lat,\n        lon : msg.payload.position.lon,\n        alt : msg.payload.position.alt,\n        Temps_h : times_h,\n        Temps_d : times_d\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":300,"wires":[["bc1a8a4c.e7d4f8"]]},{"id":"666ae57f.2121ac","type":"influxdb out","z":"f152842b.3e7d48","influxdb":"4d05bc48.c82d84","name":"","measurement":"coo","precision":"","retentionPolicy":"","x":1380,"y":440,"wires":[]},{"id":"c847032d.10ec1","type":"ttn uplink","z":"f152842b.3e7d48","name":"test","app":"8c9b96a.34f4a68","dev_id":"test","field":"","x":610,"y":60,"wires":[["27499031.7b844","9cfb5235.017ce","53a89069.401a7"]]},{"id":"16dd5372.cae6ad","type":"complete","z":"f152842b.3e7d48","name":"","scope":["384150d5.8d148"],"uncaught":false,"x":530,"y":360,"wires":[["ea0b0ce1.55e3a"]]},{"id":"17942b93.0494d4","type":"inject","z":"f152842b.3e7d48","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":135,"y":80,"wires":[["53ba278f.931a18"]],"l":false},{"id":"8ddf1b19.9ee798","type":"function","z":"f152842b.3e7d48","name":"","func":"\nvar rssi = [];\nvar rssii;\nvar logMsgs = [];\nvar moy;\n\n\nif(msg.metadata === undefined){\n    rssii = msg.DB[0].RSSI;\n    msg.payload ={\n        RSSI : rssii,\n        Lacuna_Sat : 0\n    }\n} else {\n    if(msg.payload.lacuna_sat !== 0){\n\n    msg.payload ={\n       // RSSI :  msg.metadata.gateways[0].rssi,\n        Lacuna_Sat : msg.payload.lacuna_sat,\n        Dates : msg.metadata.time\n    }\n}\nelse{\n    var gatewaysarray = msg.metadata.gateways;\nfor (i = 0; i < gatewaysarray.length; i++){\n    rssi[i]= gatewaysarray[i].rssi;}\n    moy = (rssi[0]+rssi[1])/2;\n    \n    \n    msg.payload ={\n        RSSI : moy,\n        Lacuna_Sat : msg.payload.lacuna_sat,\n      \n    }\n}\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":260,"wires":[["bc1a8a4c.e7d4f8"]]},{"id":"bc1a8a4c.e7d4f8","type":"join","z":"f152842b.3e7d48","name":"","mode":"custom","build":"merged","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"10s","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1190,"y":440,"wires":[["666ae57f.2121ac","3b84e0d.000782"]]},{"id":"1de8ea59.3cde96","type":"function","z":"f152842b.3e7d48","name":"","func":"msg.payload = msg.payload;\nmsg.complete = true;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":360,"wires":[["bc1a8a4c.e7d4f8"]]},{"id":"22f00306.e177cc","type":"influxdb in","z":"f152842b.3e7d48","influxdb":"4d05bc48.c82d84","name":"DB","query":"select * from dist where RSSI != 0 order by time DESC limit 1 ","rawOutput":false,"precision":"","retentionPolicy":"","x":410,"y":260,"wires":[["f18f6dab.0bb46"]]},{"id":"27499031.7b844","type":"debug","z":"f152842b.3e7d48","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":770,"y":60,"wires":[]},{"id":"3b84e0d.000782","type":"debug","z":"f152842b.3e7d48","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1210,"y":320,"wires":[]},{"id":"f18f6dab.0bb46","type":"change","z":"f152842b.3e7d48","name":"","rules":[{"t":"set","p":"DB","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":260,"wires":[["8ddf1b19.9ee798"]]},{"id":"4ef9a97a.4eee48","type":"function","z":"f152842b.3e7d48","name":"","func":"var time = [];\nvar time2 =[];\nvar j=0;\nvar Jour=[],Mois=[],Annee=[],Heure=[],Minute=[],Seconde=[];\n\n\nfor(i=0;i<msg.payload.length;i++){\nvar d = new Date(msg.payload[i].time);\n//time[i] = msg.payload[i].time; \nSeconde[i] = d.getUTCSeconds(msg.payload[i].time); //Retrieve seconds from our time\nMinute[i] = d.getUTCMinutes(msg.payload[i].time);  //Retrieve minutes from our time\nHeure[i] = d.getUTCHours(msg.payload[i].time);   //Retrieve hours from our time\nJour[i] = d.getUTCDay(msg.payload[i].time);  //Retrieve days from our time\nMois[i] = d.getUTCMonth(msg.payload[i].time)+1;  //Retrieve months from our time\nAnnee[i] = d.getUTCFullYear(msg.payload[i].time);  //Retrieve years from our time\ntime[i] = Jour[i] +\"/\"+ Mois[i] +\"/\" + Annee[i]; //Create a string compose by Day/Month/Year for each points\n}\n\n/*for(i=0;i<msg.payload.length;i++){\n    time2[0] = time[0];\n    if(time2[j]!=time[i]){\n        j++;\n        time2[j]=time[i];\n    }\n \n}*/\n msg.payload={\n    Dates:time\n}\nreturn msg;  ","outputs":1,"noerr":0,"x":1190,"y":1300,"wires":[[]]},{"id":"ec3462a6.99bf5","type":"function","z":"f152842b.3e7d48","name":"Compute device List","func":"msg.payload = {};\nif(msg.index<msg.toto.length)\n{\n    \n    msg.query=\"select * from coo where lat = \" +msg.toto[msg.index].lat+ \"order by time DESC limit 1\"\n    msg.index++;\n    return msg;\n}\n","outputs":1,"noerr":0,"x":500,"y":1040,"wires":[["801dfc46.20af8"]]},{"id":"801dfc46.20af8","type":"influxdb in","z":"f152842b.3e7d48","influxdb":"4d05bc48.c82d84","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":690,"y":1040,"wires":[["5b40db14.b7e054"]]},{"id":"b07afdb8.f62fd","type":"function","z":"f152842b.3e7d48","name":"","func":"var time;\nvar Jour,Mois,Annee,Heure,Minute,Seconde;\n\nvar d = new Date(msg.payload[0].time);\nSeconde = d.getUTCSeconds(msg.payload[0].time); //Retrieve seconds from our time\nMinute = d.getUTCMinutes(msg.payload[0].time);  //Retrieve minutes from our time\nHeure = d.getUTCHours(msg.payload[0].time);   //Retrieve hours from our time\nJour = d.getUTCDay(msg.payload[0].time);  //Retrieve days from our time\nMois= d.getUTCMonth(msg.payload[0].time)+1;  //Retrieve months from our time\nAnnee = d.getUTCFullYear(msg.payload[0].time);  //Retrieve years from our time\ntime = Jour +\"/\"+ Mois +\"/\" + Annee; //Create a string compose by Day/Month/Year for each points\n\nmsg.payload ={\n    date : time\n}\nreturn msg;\n\n\n","outputs":1,"noerr":0,"x":890,"y":1140,"wires":[["ec3462a6.99bf5","f360c2fb.1d993"]]},{"id":"9e0a395e.4519e8","type":"inject","z":"f152842b.3e7d48","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":1000,"wires":[["7b0c04a1.182e9c"]]},{"id":"7b0c04a1.182e9c","type":"influxdb in","z":"f152842b.3e7d48","influxdb":"4d05bc48.c82d84","name":"","query":"select * from coo order by time desc","rawOutput":false,"precision":"","retentionPolicy":"","x":560,"y":1000,"wires":[["acc11893.e1eec8"]]},{"id":"acc11893.e1eec8","type":"function","z":"f152842b.3e7d48","name":"","func":"msg.index=0;\nmsg.max = msg.payload.length;\nmsg.toto=msg.payload;\n\n//Rentrer la date que vous souhaitez afficher\n//La plus vieille date étant \"6/5/2020\"\n/*date = \"0/7/2020\"\nvar time = [];\nvar time2 = [];\nvar Jour=[],Mois=[],Annee=[],Heure=[],Minute=[],Seconde=[];\n\n\nfor(i=0;i<msg.toto.length;i++){\nvar d = new Date(msg.payload[i].time);\ntime[i] = msg.payload[i].time; \nSeconde[i] = d.getUTCSeconds(msg.payload[i].time); //Retrieve seconds from our time\nMinute[i] = d.getUTCMinutes(msg.payload[i].time);  //Retrieve minutes from our time\nHeure[i] = d.getUTCHours(msg.payload[i].time);   //Retrieve hours from our time\nJour[i] = d.getUTCDay(msg.payload[i].time);  //Retrieve days from our time\nMois[i] = d.getUTCMonth(msg.payload[i].time)+1;  //Retrieve months from our time\nAnnee[i] = d.getUTCFullYear(msg.payload[i].time);  //Retrieve years from our time\ntime2[i] = Jour[i] +\"/\"+ Mois[i] +\"/\" + Annee[i]; //Create a string compose by Day/Month/Year for each points\n}\n/*while(date !== time2[msg.index]) //While the date of our position is different as requiert date\n{\n    msg.index++;  // Increment global variable \"index\"\n\n}\nfor(i=0;i<msg.payload.length;i++){ \n    if(date == time2[i])  // Get the last time where the requiert time is seen\n    {\n       msg.max = i ; //Get the value of \"i\"\n    }\n}\nmsg.payload={\n    dates:time2\n}*/\nreturn msg;\n","outputs":1,"noerr":0,"x":910,"y":1000,"wires":[["2229e1ec.a7023e","ec3462a6.99bf5"]]},{"id":"2229e1ec.a7023e","type":"debug","z":"f152842b.3e7d48","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1230,"y":1040,"wires":[]},{"id":"f360c2fb.1d993","type":"influxdb out","z":"f152842b.3e7d48","influxdb":"d8e4a73a.781d48","name":"","measurement":"Dates","precision":"","retentionPolicy":"","x":1150,"y":1140,"wires":[]},{"id":"5b40db14.b7e054","type":"switch","z":"f152842b.3e7d48","name":"","property":"payload[0]","propertyType":"msg","rules":[{"t":"null"},{"t":"nnull"}],"checkall":"true","repair":false,"outputs":2,"x":350,"y":1140,"wires":[["ec3462a6.99bf5"],["b07afdb8.f62fd"]]},{"id":"e2a20095.21f8f","type":"function","z":"f152842b.3e7d48","name":"","func":"var times;\nvar Jour,Mois,Annee,Heure,Minute,Seconde;\n\nvar d = new Date(msg.payload[0].time);\nSeconde = d.getUTCSeconds(msg.payload[0].time); //Retrieve seconds from our time\nMinute = d.getUTCMinutes(msg.payload[0].time);  //Retrieve minutes from our time\nHeure = d.getUTCHours(msg.payload[0].time);   //Retrieve hours from our time\nJour = d.getUTCDay(msg.payload[0].time);  //Retrieve days from our time\nMois= d.getUTCMonth(msg.payload[0].time)+1;  //Retrieve months from our time\nAnnee = d.getUTCFullYear(msg.payload[0].time);  //Retrieve years from our time\ntimes = Jour +\"/\"+ Mois +\"/\" + Annee; //Create a string compose by Day/Month/Year for each points\n\nmsg.payload ={\n    date : times\n}\nreturn msg;\n\n\n","outputs":1,"noerr":0,"x":230,"y":760,"wires":[["fb7c0885.41a388","2a033b3f.c982c4"]]},{"id":"fb7c0885.41a388","type":"influxdb out","z":"f152842b.3e7d48","influxdb":"d8e4a73a.781d48","name":"","measurement":"Dates","precision":"","retentionPolicy":"","x":270,"y":800,"wires":[]},{"id":"957b7719.b56c38","type":"influxdb in","z":"f152842b.3e7d48","influxdb":"4d05bc48.c82d84","name":"","query":"select * from coo order by time desc limit 1","rawOutput":false,"precision":"","retentionPolicy":"","x":380,"y":720,"wires":[[]]},{"id":"19cdb4f0.7c2aeb","type":"complete","z":"f152842b.3e7d48","name":"","scope":["ecaa76a3.e50a28","c847032d.10ec1"],"uncaught":false,"x":250,"y":680,"wires":[["957b7719.b56c38"]]},{"id":"acb71640.5670b8","type":"inject","z":"f152842b.3e7d48","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":260,"y":640,"wires":[["957b7719.b56c38"]]},{"id":"2a033b3f.c982c4","type":"debug","z":"f152842b.3e7d48","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":250,"y":840,"wires":[]},{"id":"9cfb5235.017ce","type":"switch","z":"f152842b.3e7d48","name":"","property":"msg.payload.lacuna_sat","propertyType":"msg","rules":[{"t":"neq","v":"0","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":850,"y":100,"wires":[["72702f98.356fb"],["8ddf1b19.9ee798"]]},{"id":"1aa27359.99df9d","type":"influxdb out","z":"f152842b.3e7d48","influxdb":"d8e4a73a.781d48","name":"","measurement":"dist","precision":"","retentionPolicy":"","x":580,"y":300,"wires":[]},{"id":"df30c0b2.f4152","type":"inject","z":"f152842b.3e7d48","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":430,"y":500,"wires":[["aedd64a7.f80d38"]]},{"id":"223eafd0.36bf","type":"influxdb in","z":"f152842b.3e7d48","influxdb":"d8e4a73a.781d48","name":"","query":"drop measurement coo","rawOutput":false,"precision":"","retentionPolicy":"","x":860,"y":500,"wires":[[]]},{"id":"aedd64a7.f80d38","type":"time-switch","z":"f152842b.3e7d48","name":"","lat":"","lon":"","startTime":"18:00","endTime":"18:01","startOffset":0,"endOffset":0,"x":610,"y":500,"wires":[["223eafd0.36bf"],[]]},{"id":"c93c268b.f61b48","type":"function","z":"f152842b.3e7d48","name":"","func":"msg.payload={\n    x : msg.payload.position.x,\n    y : msg.payload.position.y,\n    z : msg.payload.position.z,\n}\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":300,"wires":[["1aa27359.99df9d"]]},{"id":"53a89069.401a7","type":"influxdb out","z":"f152842b.3e7d48","influxdb":"d8e4a73a.781d48","name":"","measurement":"dist","precision":"","retentionPolicy":"","x":820,"y":160,"wires":[]},{"id":"ea0b0ce1.55e3a","type":"subflow:59de1744.528cf8","z":"f152842b.3e7d48","name":"","env":[],"x":740,"y":360,"wires":[["1de8ea59.3cde96"]]},{"id":"72702f98.356fb","type":"function","z":"f152842b.3e7d48","name":"","func":"var Dates = msg.metadata.time;\nvar d = new Date(Dates);\nSeconde = d.getUTCSeconds(Dates); //Retrieve seconds from our time\nMinute = d.getUTCMinutes(Dates);  //Retrieve minutes from our time\nHeure = d.getUTCHours(Dates);   //Retrieve hours from our time\nJour = d.getUTCDay(Dates);  //Retrieve days from our time\nMois= d.getUTCMonth(Dates)+1;  //Retrieve months from our time\nAnnee = d.getUTCFullYear(Dates);  //Retrieve years from our time\ntimes = Heure+\":\"+Minute+\":\"+Seconde; //Create a string compose by Day/Month/Year for each points\nmsg.payload={\n}\nmsg.id = msg.dev_id;\nmsg.count = msg.counter;\nmsg.query = \"select * from coo where Temps_h = '\"+times+\"'\";\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":100,"wires":[["685c27e0.e63538","ca03d4c9.1a84f8"]]},{"id":"685c27e0.e63538","type":"influxdb in","z":"f152842b.3e7d48","influxdb":"d8e4a73a.781d48","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":1190,"y":100,"wires":[["a9723f8c.b23db","15d02bc1.998424"]]},{"id":"703f83b.58f687c","type":"influxdb out","z":"f152842b.3e7d48","influxdb":"d8e4a73a.781d48","name":"","measurement":"lacuna","precision":"","retentionPolicy":"","x":1530,"y":100,"wires":[]},{"id":"a9723f8c.b23db","type":"function","z":"f152842b.3e7d48","name":"","func":"msg.payload={\n    lat : msg.payload[0].lat,\n    lon : msg.payload[0].lon,\n   alt : msg.payload[0].alt,\n    counter : msg.count,\n   id : msg.id,\n    Temps_h : msg.payload[0].Temps_h,\n    Temps_d : msg.payload[0].Temps_d,\n    Distance : msg.payload[0].Distance,\n   // rssi : msg.metadata.gateways[0].rssi\n}\nreturn msg;","outputs":1,"noerr":0,"x":1350,"y":100,"wires":[["703f83b.58f687c","cb859fa6.b30ed"]]},{"id":"ca03d4c9.1a84f8","type":"debug","z":"f152842b.3e7d48","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1440,"y":20,"wires":[]},{"id":"58c54078.10703","type":"ttn uplink","z":"f152842b.3e7d48","name":"test2","app":"8c9b96a.34f4a68","dev_id":"test2","field":"","x":610,"y":100,"wires":[["9cfb5235.017ce","53a89069.401a7"]]},{"id":"407f99a6.320938","type":"ttn uplink","z":"f152842b.3e7d48","name":"test3","app":"8c9b96a.34f4a68","dev_id":"test3","field":"","x":610,"y":140,"wires":[["9cfb5235.017ce","53a89069.401a7"]]},{"id":"cb859fa6.b30ed","type":"debug","z":"f152842b.3e7d48","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1510,"y":160,"wires":[]},{"id":"25300d5e.6f6d12","type":"subflow:46051912.a9cae8","z":"f152842b.3e7d48","name":"","env":[],"x":170,"y":340,"wires":[["22f00306.e177cc","c93c268b.f61b48","b34bcc6e.3e0ea","384150d5.8d148"]]},{"id":"b1f90abe.e7e518","type":"debug","z":"f152842b.3e7d48","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":530,"y":420,"wires":[]},{"id":"53ba278f.931a18","type":"time-switch","z":"f152842b.3e7d48","name":"","lat":"43.716894","lon":"7.125650","startTime":"21:00","endTime":"23:00","startOffset":0,"endOffset":0,"x":150,"y":120,"wires":[["ecaa76a3.e50a28"],[]]},{"id":"a63ddc89.56c33","type":"debug","z":"f152842b.3e7d48","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1200,"y":720,"wires":[]},{"id":"15d02bc1.998424","type":"debug","z":"f152842b.3e7d48","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1300,"y":220,"wires":[]},{"id":"797d764c.de0698","type":"function","z":"bece6195.3824f","name":"Query","func":"msg.query = \"select * from dist order by time DESC limit 2\"\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":260,"wires":[["1f25ce3b.7aafa2"]]},{"id":"1f25ce3b.7aafa2","type":"influxdb in","z":"bece6195.3824f","influxdb":"4d05bc48.c82d84","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":630,"y":300,"wires":[["d8cb0d7d.4e413"]]},{"id":"d8cb0d7d.4e413","type":"function","z":"bece6195.3824f","name":"Calcul Distance","func":"var x2 = msg.payload[1].Accx;\nvar y2 = msg.payload[1].Accy;\nvar z2 = msg.payload[1].Accz;\nvar x1 = msg.payload[0].x;\nvar y1 = msg.payload[0].y;\nvar z1 = msg.payload[0].z;\nmsg.payload ={\n  Distance : (x1*x1-x2*x2)+(y1*y1-y2*y2)+\n  (z1*z1-z2*z2),\n}\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":340,"wires":[["c6e24c02.52f6b"]]},{"id":"c6e24c02.52f6b","type":"calculator","z":"bece6195.3824f","name":"","inputMsgField":"payload.Distance","outputMsgField":"payload.Distance","operation":"sqrt","constant":"","x":630,"y":380,"wires":[[]]}]
