# Remplissage de ma Database 

## Code 
[{"id":"d8f99284.f2a5a","type":"tab","label":"Capteurs_Sophia","disabled":false,"info":""},{"id":"1bb3c7b2.7f62b8","type":"ttn uplink","z":"d8f99284.f2a5a","name":"Capteur interieur","app":"60748344.90604c","dev_id":"capteur_interieur","field":"","x":180,"y":320,"wires":[["8059b92d.6fd718"]]},{"id":"580769a.21c9098","type":"ttn uplink","z":"d8f99284.f2a5a","name":"Capteur Serre","app":"60748344.90604c","dev_id":"capteur_serre","field":"","x":170,"y":520,"wires":[["d861ff25.d3c16"]]},{"id":"8059b92d.6fd718","type":"function","z":"d8f99284.f2a5a","name":"","func":"msg.payload ={\n        T_int : msg.payload.temperature_1,\n        H_int: msg.payload.relative_humidity_2,\n        Lum_int : msg.payload.luminosity_4\n}\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":380,"wires":[["3a043dcb.326432"]]},{"id":"d861ff25.d3c16","type":"function","z":"d8f99284.f2a5a","name":"","func":"msg.payload ={\n        T_serre : msg.payload.temperature_1,\n        H_serre: msg.payload.relative_humidity_5,\n        Lum_serre : msg.payload.luminosity_4\n}\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":580,"wires":[["800248da.b8fe98"]]},{"id":"716f3fad.220bb","type":"ttn uplink","z":"d8f99284.f2a5a","name":"Device toto","app":"60748344.90604c","dev_id":"device_toto","field":"","x":160,"y":680,"wires":[["90fcd68a.331b88"]]},{"id":"c7f06bab.16af48","type":"ttn uplink","z":"d8f99284.f2a5a","name":"sensor smartcampus","app":"60748344.90604c","dev_id":"sensor_smartcampus","field":"","x":190,"y":880,"wires":[["21cb57d1.6655f8"]]},{"id":"90fcd68a.331b88","type":"function","z":"d8f99284.f2a5a","name":"","func":"msg.payload ={\n        T_toto : msg.payload.temperature_1,\n        H_toto: msg.payload.relative_humidity_2,\n        Lum_toto : msg.payload.luminosity_4\n}\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":740,"wires":[["62e8d9b2.7afa28"]]},{"id":"21cb57d1.6655f8","type":"function","z":"d8f99284.f2a5a","name":"","func":"msg.payload ={\n        T_smartcampus : msg.payload.temperature_4,\n        H_smartcampus: msg.payload.relative_humidity_5,\n        Lum_smartcampus : msg.payload.luminosity_6\n}\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":920,"wires":[["477d4b4b.e7d944"]]},{"id":"3a043dcb.326432","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"Sensors_int","precision":"","retentionPolicy":"","x":210,"y":440,"wires":[]},{"id":"800248da.b8fe98","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"Sensors_Serre","precision":"","retentionPolicy":"","x":220,"y":620,"wires":[]},{"id":"62e8d9b2.7afa28","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"Sensors_toto","precision":"","retentionPolicy":"","x":210,"y":800,"wires":[]},{"id":"477d4b4b.e7d944","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"Sensors_smartcampus","precision":"","retentionPolicy":"","x":240,"y":980,"wires":[]},{"id":"ecf32158.c9492","type":"ttn uplink","z":"d8f99284.f2a5a","name":"test2","app":"f9fcd79e.6f7c98","dev_id":"test2","field":"","x":130,"y":1140,"wires":[["b7c7c33d.2afb9","97dee037.b36aa"]]},{"id":"11b4f985.b1a4f6","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"Test2","precision":"","retentionPolicy":"","x":910,"y":1160,"wires":[]},{"id":"b7c7c33d.2afb9","type":"function","z":"d8f99284.f2a5a","name":"","func":"var gatewaysarray = msg.metadata.gateways;\nvar rssi = [];\nvar logMsgs = [];\nvar moy;\n\nfor (i = 0; i < gatewaysarray.length; i++){\n    rssi[i]= gatewaysarray[i].rssi;}\n    moy = (rssi[0]+rssi[1])/2;\n\nmsg.payload ={\n       Accx : msg.payload.accx,\n       Accy : msg.payload.accy,\n       Accz : msg.payload.accz,\n       Humidity : msg.payload.humidity,\n       Lacuna_Sat : msg.payload.lacuna_sat,\n       Lat : msg.payload.lat,\n       Lon : msg.payload.lng,\n       Length : msg.payload.length,\n       Pressure : msg.payload.pressure,\n       Temp : msg.payload.temperature,\n       Tleage : msg.payload.tleage,\n       TTF : msg.payload.ttf,\n       Voltage : msg.payload.voltage,\n       Voltage_adc : msg.payload.voltage_adc,\n       Lacuna_sat : msg.payload.lacuna_sat,\n       RSSI : moy\n}\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":1140,"wires":[["11b4f985.b1a4f6"]]},{"id":"97dee037.b36aa","type":"function","z":"d8f99284.f2a5a","name":"","func":"msg.payload ={\n        Accx : msg.payload.accx,\n        Accy : msg.payload.accy,\n        Accz : msg.payload.accz,\n    \n}\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":1260,"wires":[["bd9ec67a.2e2208"]]},{"id":"bd9ec67a.2e2208","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"dist","precision":"","retentionPolicy":"","x":640,"y":1260,"wires":[]},{"id":"5eb3afbf.4b13c","type":"function","z":"d8f99284.f2a5a","name":"","func":"msg.payload ={\n        T_ext : msg.payload.temperature_1,\n        H_ext: msg.payload.relative_humidity_2,\n        Lum_ext : msg.payload.luminosity_4,\n}\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":180,"wires":[["f2fa42cc.d6147"]]},{"id":"ca2d2051.e01b8","type":"ttn uplink","z":"d8f99284.f2a5a","name":"Capteur exterieur","app":"60748344.90604c","dev_id":"capteur_exterieur","field":"","x":180,"y":120,"wires":[["5eb3afbf.4b13c"]]},{"id":"f2fa42cc.d6147","type":"influxdb out","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","measurement":"Sensors_ext","precision":"","retentionPolicy":"","x":190,"y":240,"wires":[]},{"id":"ce0ee67c.a69928","type":"function","z":"d8f99284.f2a5a","name":"","func":"var m = {};\nvar labels = []\nvar data = [];\n\nvar time = [];\nvar time2 = [];\nvar hour=[],minutes=[],second=[];\nvar analog = [] ,luminosity = [],humidity=[],temperature=[];\n\nfor(i=0;i<msg.payload.length;i++){\nvar d = new Date(msg.payload[i].time);\nluminosity[i] = parseInt(msg.payload[i].Lum_ext);\nhumidity[i] = parseInt(msg.payload[i].H_ext);\ntemperature[i] = parseInt(msg.payload[i].T_ext);\n\ntime[i] = msg.payload[i].time;\nhour[i] = d.getHours(msg.payload[i].time);\nminutes[i] = d.getMinutes(msg.payload[i].time);\nsecond[i] = d.getSeconds(msg.payload[i].time);\ntime2[i] = hour[i] +\"h\"+ minutes[i] +\"min\" + second[i] + \"s\";\n}\n    m.series = [\"Luminosity\",\"Humidity\",\"Temperature\"];\n    m.data = [luminosity,humidity,temperature];\n    m.labels = time2\nreturn {\n    payload:[m] ,\n    topic : msg.topic\n    \n};","outputs":1,"noerr":0,"x":630,"y":200,"wires":[[]]},{"id":"7258327e.24824c","type":"influxdb in","z":"d8f99284.f2a5a","influxdb":"ac69b075.a9d24","name":"","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":650,"y":160,"wires":[["ce0ee67c.a69928"]]},{"id":"2449920a.91b58e","type":"function","z":"d8f99284.f2a5a","name":"","func":"msg.query =\"select * from Sensors_ext order by time DESC limit 50\"\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":120,"wires":[["7258327e.24824c"]]},{"id":"23c27162.80a09e","type":"complete","z":"d8f99284.f2a5a","name":"","scope":["5eb3afbf.4b13c"],"uncaught":false,"x":650,"y":40,"wires":[[]]},{"id":"b79bdb7d.a83ca8","type":"inject","z":"d8f99284.f2a5a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":460,"y":120,"wires":[["2449920a.91b58e"]]},{"id":"d21200a5.4c6a1","type":"complete","z":"d8f99284.f2a5a","name":"","scope":["5eb3afbf.4b13c"],"uncaught":false,"x":970,"y":300,"wires":[[]]},{"id":"60748344.90604c","type":"ttn app","z":"","appId":"valrose","accessKey":"ttn-account-v2.gg2ImosZ1sYrrHkwZwyy9FtuSeFD_WSMT0-P3WvBORA","discovery":"discovery.thethingsnetwork.org:1900"},{"id":"ac69b075.a9d24","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"Sensor_IOT","name":"Sensor_iOT","usetls":false,"tls":""},{"id":"f9fcd79e.6f7c98","type":"ttn app","z":"","appId":"ph0wn","accessKey":"ttn-account-v2.yTbE4m7S7rR7vDrRK7fEBtaL4GTN5ucffn02NT2VgC8","discovery":"discovery.thethingsnetwork.org:1900"}]
